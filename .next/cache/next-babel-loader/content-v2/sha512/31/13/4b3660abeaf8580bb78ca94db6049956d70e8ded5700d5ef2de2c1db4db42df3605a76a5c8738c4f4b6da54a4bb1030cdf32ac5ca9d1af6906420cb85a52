{"ast":null,"code":"const multer = require(\"multer\"); //import { MongoClient } from \"mongodb\";\n\n\nfunction uploadImage(req, res) {\n  if (req.method === \"POST\") {\n    const {\n      file\n    } = req;\n    console.log(\"File: \", file);\n    console.log(\"Uploading image\");\n    const fileStorageEngine = multer.diskStorage({\n      destination: (req, file, cb) => {\n        cb(null, \"/images\");\n      },\n      filename: (req, file, cb) => {\n        cb(null, Date.now() + \"--\" + file.originalname);\n      }\n    });\n    const upload = multer({\n      storage: fileStorageEngine\n    });\n\n    try {\n      upload.single(\"image\");\n      console.log(file); //res.send(\"Single File upload success\");\n\n      res.status(200).json({\n        message: \"Single File upload success\"\n      });\n    } catch (error) {\n      res.status(500).json({\n        message: \"Error uploading Single File\"\n      });\n    }\n    /*\n    /* UP TO HERE UPDATED */\n\n    /*\n    /*\n    if (\n    !email ||\n    !email.includes(\"@\") ||\n    !name ||\n    name.trim() === \"\" ||\n    !message ||\n    message.trim() === \"\"\n    ) {\n    res.status(422).json({ message: \"Invalid input.\" });\n    return;\n    }\n    // Store it in a database\n    const newMessage = { email, name, message };\n    let client;\n    const connectionString = `mongodb+srv://${process.env.mongodb_username}:${process.env.mongodb_password}@${process.env.mongodb_clustername}.l9qi7.mongodb.net/${process.env.mongodb_database}?retryWrites=true&w=majority`;\n    try {\n    client = await MongoClient.connect(connectionString);\n    / * client = await MongoClient.connect(\n    \"mongodb+srv://nextjs-user:L0ngAndBeautifulPassw0rd!@cluster0.l9qi7.mongodb.net/NextJSSection11?retryWrites=true&w=majority\"\n    ); * / \n    } catch (error) {\n    res.status(500).json({ message: \"Cold not connect to the database\" });\n    return;\n    }\n    const db = client.db(process.env.mongodb_database);\n    try {\n    const result = await db.collection(\"form-messages\").insertOne(newMessage);\n    newMessage.id = result.insertedId;\n    } catch (error) {\n    client.close();\n    res.status(500).json({ message: \"Storing message failed!\" });\n    return;\n    }\n    client.close();\n    console.log(newMessage);\n    res\n    .status(201)\n    .json({ message: \"Successfully stored message!\", message: newMessage });\n    */\n\n  }\n}\n\nexport default uploadImage;","map":{"version":3,"sources":["/Users/peynao/Documents/Datos/Front End Developer/NextJS/Section 12/nextjs-course-code-07849776424a7b0f111804e1130acc4e61169252/pages/api/uploadImage.js"],"names":["multer","require","uploadImage","req","res","method","file","console","log","fileStorageEngine","diskStorage","destination","cb","filename","Date","now","originalname","upload","storage","single","status","json","message","error"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAAtB,C,CAEA;;;AAEA,SAASC,WAAT,CAAqBC,GAArB,EAA0BC,GAA1B,EAA+B;AAC7B,MAAID,GAAG,CAACE,MAAJ,KAAe,MAAnB,EAA2B;AACzB,UAAM;AAAEC,MAAAA;AAAF,QAAWH,GAAjB;AAEAI,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBF,IAAtB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;AAEA,UAAMC,iBAAiB,GAAGT,MAAM,CAACU,WAAP,CAAmB;AAC3CC,MAAAA,WAAW,EAAE,CAACR,GAAD,EAAMG,IAAN,EAAYM,EAAZ,KAAmB;AAC9BA,QAAAA,EAAE,CAAC,IAAD,EAAO,SAAP,CAAF;AACD,OAH0C;AAI3CC,MAAAA,QAAQ,EAAE,CAACV,GAAD,EAAMG,IAAN,EAAYM,EAAZ,KAAmB;AAC3BA,QAAAA,EAAE,CAAC,IAAD,EAAOE,IAAI,CAACC,GAAL,KAAa,IAAb,GAAoBT,IAAI,CAACU,YAAhC,CAAF;AACD;AAN0C,KAAnB,CAA1B;AASA,UAAMC,MAAM,GAAGjB,MAAM,CAAC;AAAEkB,MAAAA,OAAO,EAAET;AAAX,KAAD,CAArB;;AAEA,QAAI;AACFQ,MAAAA,MAAM,CAACE,MAAP,CAAc,OAAd;AACAZ,MAAAA,OAAO,CAACC,GAAR,CAAYF,IAAZ,EAFE,CAGF;;AACAF,MAAAA,GAAG,CAACgB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACD,KALD,CAKE,OAAOC,KAAP,EAAc;AACdnB,MAAAA,GAAG,CAACgB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACD;AAAC;AACN;;AAC6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAQG;AACF;;AAED,eAAepB,WAAf","sourcesContent":["const multer = require(\"multer\");\n\n//import { MongoClient } from \"mongodb\";\n\nfunction uploadImage(req, res) {\n  if (req.method === \"POST\") {\n    const { file } = req;\n\n    console.log(\"File: \", file);\n    console.log(\"Uploading image\");\n\n    const fileStorageEngine = multer.diskStorage({\n      destination: (req, file, cb) => {\n        cb(null, \"/images\");\n      },\n      filename: (req, file, cb) => {\n        cb(null, Date.now() + \"--\" + file.originalname);\n      },\n    });\n\n    const upload = multer({ storage: fileStorageEngine });\n\n    try {\n      upload.single(\"image\");\n      console.log(file);\n      //res.send(\"Single File upload success\");\n      res.status(200).json({ message: \"Single File upload success\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Error uploading Single File\" });\n    } /*\n\n    /* UP TO HERE UPDATED */ /*\n    /*\n    if (\n      !email ||\n      !email.includes(\"@\") ||\n      !name ||\n      name.trim() === \"\" ||\n      !message ||\n      message.trim() === \"\"\n    ) {\n      res.status(422).json({ message: \"Invalid input.\" });\n      return;\n    }\n\n    // Store it in a database\n    const newMessage = { email, name, message };\n\n    let client;\n\n    const connectionString = `mongodb+srv://${process.env.mongodb_username}:${process.env.mongodb_password}@${process.env.mongodb_clustername}.l9qi7.mongodb.net/${process.env.mongodb_database}?retryWrites=true&w=majority`;\n\n    try {\n      client = await MongoClient.connect(connectionString);\n      / * client = await MongoClient.connect(\n        \"mongodb+srv://nextjs-user:L0ngAndBeautifulPassw0rd!@cluster0.l9qi7.mongodb.net/NextJSSection11?retryWrites=true&w=majority\"\n      ); * / \n    } catch (error) {\n      res.status(500).json({ message: \"Cold not connect to the database\" });\n      return;\n    }\n\n    const db = client.db(process.env.mongodb_database);\n    try {\n      const result = await db.collection(\"form-messages\").insertOne(newMessage);\n      newMessage.id = result.insertedId;\n    } catch (error) {\n      client.close();\n      res.status(500).json({ message: \"Storing message failed!\" });\n      return;\n    }\n\n    client.close();\n\n    console.log(newMessage);\n    res\n    .status(201)\n    .json({ message: \"Successfully stored message!\", message: newMessage });\n    */\n  }\n}\n\nexport default uploadImage;\n"]},"metadata":{},"sourceType":"module"}