{"ast":null,"code":"const multer = require(\"multer\"); //import { MongoClient } from \"mongodb\";\n\n\nconst fileStorageEngine = multer.diskStorage({\n  destination: (req, file, cb) => {\n    cb(null, \"/images\");\n  },\n  filename: (req, file, cb) => {\n    cb(null, Date.now() + \"--\" + file.originalname);\n  }\n});\n\nfunction uploadImage(req, res) {\n  if (req.method === \"POST\") {\n    const {\n      file\n    } = req.body;\n    console.log(\"req.body: \", req.body);\n    console.log(\"req.body.file: \", req.body.file);\n    console.log(\"req.body.image: \", req.body.image);\n    console.log(\"Uploading image...\");\n    const upload = multer({\n      storage: fileStorageEngine\n    });\n\n    try {\n      upload.single(\"image\");\n      console.log(file); //res.send(\"Single File upload success\");\n\n      res.status(200).json({\n        message: \"Single File upload success\"\n      });\n    } catch (error) {\n      res.status(500).json({\n        message: \"Error uploading Single File\"\n      });\n    }\n    /*\n    /* UP TO HERE UPDATED */\n\n    /*\n    /*\n    if (\n    !email ||\n    !email.includes(\"@\") ||\n    !name ||\n    name.trim() === \"\" ||\n    !message ||\n    message.trim() === \"\"\n    ) {\n    res.status(422).json({ message: \"Invalid input.\" });\n    return;\n    }\n    // Store it in a database\n    const newMessage = { email, name, message };\n    let client;\n    const connectionString = `mongodb+srv://${process.env.mongodb_username}:${process.env.mongodb_password}@${process.env.mongodb_clustername}.l9qi7.mongodb.net/${process.env.mongodb_database}?retryWrites=true&w=majority`;\n    try {\n    client = await MongoClient.connect(connectionString);\n    / * client = await MongoClient.connect(\n    \"mongodb+srv://nextjs-user:L0ngAndBeautifulPassw0rd!@cluster0.l9qi7.mongodb.net/NextJSSection11?retryWrites=true&w=majority\"\n    ); * / \n    } catch (error) {\n    res.status(500).json({ message: \"Cold not connect to the database\" });\n    return;\n    }\n    const db = client.db(process.env.mongodb_database);\n    try {\n    const result = await db.collection(\"form-messages\").insertOne(newMessage);\n    newMessage.id = result.insertedId;\n    } catch (error) {\n    client.close();\n    res.status(500).json({ message: \"Storing message failed!\" });\n    return;\n    }\n    client.close();\n    console.log(newMessage);\n    res\n    .status(201)\n    .json({ message: \"Successfully stored message!\", message: newMessage });\n    */\n\n  }\n}\n\nexport default uploadImage;","map":{"version":3,"sources":["/Users/peynao/Documents/Datos/Front End Developer/NextJS/Section 12/nextjs-course-code-07849776424a7b0f111804e1130acc4e61169252/pages/api/uploadImage.js"],"names":["multer","require","fileStorageEngine","diskStorage","destination","req","file","cb","filename","Date","now","originalname","uploadImage","res","method","body","console","log","image","upload","storage","single","status","json","message","error"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAAtB,C,CAEA;;;AAEA,MAAMC,iBAAiB,GAAGF,MAAM,CAACG,WAAP,CAAmB;AAC3CC,EAAAA,WAAW,EAAE,CAACC,GAAD,EAAMC,IAAN,EAAYC,EAAZ,KAAmB;AAC9BA,IAAAA,EAAE,CAAC,IAAD,EAAO,SAAP,CAAF;AACD,GAH0C;AAI3CC,EAAAA,QAAQ,EAAE,CAACH,GAAD,EAAMC,IAAN,EAAYC,EAAZ,KAAmB;AAC3BA,IAAAA,EAAE,CAAC,IAAD,EAAOE,IAAI,CAACC,GAAL,KAAa,IAAb,GAAoBJ,IAAI,CAACK,YAAhC,CAAF;AACD;AAN0C,CAAnB,CAA1B;;AASA,SAASC,WAAT,CAAqBP,GAArB,EAA0BQ,GAA1B,EAA+B;AAC7B,MAAIR,GAAG,CAACS,MAAJ,KAAe,MAAnB,EAA2B;AACzB,UAAM;AAAER,MAAAA;AAAF,QAAWD,GAAG,CAACU,IAArB;AAEAC,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BZ,GAAG,CAACU,IAA9B;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BZ,GAAG,CAACU,IAAJ,CAAST,IAAxC;AACAU,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgCZ,GAAG,CAACU,IAAJ,CAASG,KAAzC;AACAF,IAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ;AAEA,UAAME,MAAM,GAAGnB,MAAM,CAAC;AAAEoB,MAAAA,OAAO,EAAElB;AAAX,KAAD,CAArB;;AAEA,QAAI;AACFiB,MAAAA,MAAM,CAACE,MAAP,CAAc,OAAd;AACAL,MAAAA,OAAO,CAACC,GAAR,CAAYX,IAAZ,EAFE,CAGF;;AACAO,MAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACD,KALD,CAKE,OAAOC,KAAP,EAAc;AACdZ,MAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB;AACD;AAAC;AACN;;AAC6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAQG;AACF;;AAED,eAAeZ,WAAf","sourcesContent":["const multer = require(\"multer\");\n\n//import { MongoClient } from \"mongodb\";\n\nconst fileStorageEngine = multer.diskStorage({\n  destination: (req, file, cb) => {\n    cb(null, \"/images\");\n  },\n  filename: (req, file, cb) => {\n    cb(null, Date.now() + \"--\" + file.originalname);\n  },\n});\n\nfunction uploadImage(req, res) {\n  if (req.method === \"POST\") {\n    const { file } = req.body;\n\n    console.log(\"req.body: \", req.body);\n    console.log(\"req.body.file: \", req.body.file);\n    console.log(\"req.body.image: \", req.body.image);\n    console.log(\"Uploading image...\");\n\n    const upload = multer({ storage: fileStorageEngine });\n\n    try {\n      upload.single(\"image\");\n      console.log(file);\n      //res.send(\"Single File upload success\");\n      res.status(200).json({ message: \"Single File upload success\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Error uploading Single File\" });\n    } /*\n\n    /* UP TO HERE UPDATED */ /*\n    /*\n    if (\n      !email ||\n      !email.includes(\"@\") ||\n      !name ||\n      name.trim() === \"\" ||\n      !message ||\n      message.trim() === \"\"\n    ) {\n      res.status(422).json({ message: \"Invalid input.\" });\n      return;\n    }\n\n    // Store it in a database\n    const newMessage = { email, name, message };\n\n    let client;\n\n    const connectionString = `mongodb+srv://${process.env.mongodb_username}:${process.env.mongodb_password}@${process.env.mongodb_clustername}.l9qi7.mongodb.net/${process.env.mongodb_database}?retryWrites=true&w=majority`;\n\n    try {\n      client = await MongoClient.connect(connectionString);\n      / * client = await MongoClient.connect(\n        \"mongodb+srv://nextjs-user:L0ngAndBeautifulPassw0rd!@cluster0.l9qi7.mongodb.net/NextJSSection11?retryWrites=true&w=majority\"\n      ); * / \n    } catch (error) {\n      res.status(500).json({ message: \"Cold not connect to the database\" });\n      return;\n    }\n\n    const db = client.db(process.env.mongodb_database);\n    try {\n      const result = await db.collection(\"form-messages\").insertOne(newMessage);\n      newMessage.id = result.insertedId;\n    } catch (error) {\n      client.close();\n      res.status(500).json({ message: \"Storing message failed!\" });\n      return;\n    }\n\n    client.close();\n\n    console.log(newMessage);\n    res\n    .status(201)\n    .json({ message: \"Successfully stored message!\", message: newMessage });\n    */\n  }\n}\n\nexport default uploadImage;\n"]},"metadata":{},"sourceType":"module"}